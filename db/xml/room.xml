
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="room">
    <insert id="room_insert">
    INSERT INTO fo_room_code (
    ROOM_CODE_BS
    ,ROOM_CODE_NUM
    ,ROOM_CODE_FLOOR
    ,ROOM_CODE_DCOD
    ,ROOM_CODE_HNAM
    ,ROOM_CODE_STATU
    ,ROOM_CODE_USE
    ,ROOM_CODE_SORT
    ,ROOM_CODE_FDATE
    ,ROOM_CODE_FUSER
    ,ROOM_CODE_LDATE
    ,ROOM_CODE_LUSER
    ) VALUES (
    #{bsCode}
    ,#{rono}
    ,#{floor}
    ,#{dcod}
    ,#{hnam}
    ,#{stau}
    ,1
    ,1
    ,SYSDATE()
    ,#{userId}
    ,SYSDATE()
    ,#{userId}
    )
    </insert>
    <select id="room_main_list">
        SELECT ROOM_CODE_BS,
            ROOM_CODE_KEY,
            ROOM_CODE_NUM,
            ROOM_CODE_FLOOR,
            ROOM_CODE_DCOD,
            ROOM_CODE_HNAM,
            ROOM_CODE_STATU,
            ROOM_CODE_USE,
            ROOM_CODE_SORT,
            CODE_CONTENT,
            IFNULL(ROOM_PASS_CLEANER, '') AS ROOM_PASS_CLEANER,
            IFNULL(ROOM_PASS_MASTER, '') AS ROOM_PASS_MASTER,
            IFNULL(BRIDGE_TRAN_RSPK, '') AS BRIDGE_TRAN_RSPK,
            IFNULL(BRIDGE_TRAN_ACNO, '') AS BRIDGE_TRAN_ACNO,
            IFNULL(BRIDGE_TRAN_IDATE, '') AS BRIDGE_TRAN_IDATE,
            IFNULL(BRIDGE_TRAN_ODATE, '') AS BRIDGE_TRAN_ODATE
    FROM fo_room_code ROOM
    LEFT JOIN BRIDGE_CODE CODE
    ON CODE.CODE_CODE = ROOM.ROOM_CODE_STATU
    LEFT JOIN(
    SELECT
        ROOM_DOOR_BS,
        ROOM_DOOR_KEY,
        ROOM_DOOR_RONO,
        ROOM_PASS_CLEANER,
        ROOM_PASS_MASTER
    FROM FO_ROOM_DOOR
    ) DOOR ON DOOR.ROOM_DOOR_BS = ROOM.ROOM_CODE_BS
    AND DOOR.ROOM_DOOR_RONO = ROOM.ROOM_CODE_NUM
    LEFT JOIN (
    SELECT
        BRIDGE_TRAN_RSPK,
        BRIDGE_TRAN_BS,
        BRIDGE_TRAN_ACNO,
        BRIDGE_TRAN_RONO,
        BRIDGE_TRAN_RTYPE,
        BRIDGE_TRAN_IDATE,
        BRIDGE_TRAN_ODATE,
        BRIDGE_TRAN_KCDA
    FROM fo_bridge_tran
    <![CDATA[
    WHERE BRIDGE_TRAN_IDATE <= NOW()
    AND BRIDGE_TRAN_ODATE >= NOW()
    ]]>
    AND BRIDGE_TRAN_KCDA IS NULL
    ) BRIDGE ON BRIDGE.BRIDGE_TRAN_RONO = ROOM.ROOM_CODE_NUM
    AND BRIDGE.BRIDGE_TRAN_BS = ROOM.ROOM_CODE_BS
    AND BRIDGE.BRIDGE_TRAN_RTYPE = ROOM.ROOM_CODE_DCOD
    </select>
</mapper>