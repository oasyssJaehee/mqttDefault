
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="api">
    <select id="bridge_tran_insert_key">
    SELECT IFNULL(MAX(BRIDGE_TRAN_RSPK), 0) + 1 AS RSPK
    FROM fo_bridge_tran
    </select>
    <insert id="bridge_tran_insert">
    INSERT INTO fo_bridge_tran (
    BRIDGE_TRAN_RSPK
    ,BRIDGE_TRAN_BS
    ,BRIDGE_TRAN_ACNO
    ,BRIDGE_TRAN_RONO
    ,BRIDGE_TRAN_RTYPE
    ,BRIDGE_TRAN_IDATE
    ,BRIDGE_TRAN_ODATE
    ,BRIDGE_TRAN_GNAME
    ,BRIDGE_TRAN_PHONE
    ,BRIDGE_TRAN_URL
    ,BRIDGE_TRAN_KEY
    ,BRIDGE_TRAN_KIDA
    ,BRIDGE_TRAN_FUSER
    ,BRIDGE_TRAN_LUSER
    ) VALUES (
    #{rspk}
    ,#{bcode}
    ,#{acno}
    ,#{rono}
    ,#{rtype}
    ,#{idate}
    ,#{odate}
    ,#{gname}
    ,AES_ENCRYPT(#{phone}, #{AES_KEY})
    ,#{url}
    ,#{key}
    ,SYSDATE()
    ,'user'
    ,'user'
    )
    </insert>
    <select id="bridge_tran_overlab">
    SELECT BRIDGE_TRAN_RSPK,
        BRIDGE_TRAN_BS,
        BRIDGE_TRAN_ACNO,
        BRIDGE_TRAN_RONO,
        BRIDGE_TRAN_RTYPE,
        BRIDGE_TRAN_IDATE,
        BRIDGE_TRAN_ODATE,
        BRIDGE_TRAN_GNAME,
        BRIDGE_TRAN_KIDA,
        BRIDGE_TRAN_KCDA,
        BRIDGE_TRAN_BKYB,
        BRIDGE_TRAN_KUDA,
        BRIDGE_TRAN_FUSER,
        BRIDGE_TRAN_LUSER
    FROM fo_bridge_tran
    WHERE BRIDGE_TRAN_BS = #{bcode}
    AND BRIDGE_TRAN_RONO = #{rono}
    <![CDATA[
    AND BRIDGE_TRAN_IDATE <= #{idate}
    AND BRIDGE_TRAN_ODATE >= #{idate}
    ]]>
    AND BRIDGE_TRAN_KCDA IS NULL
    </select>
</mapper>