<!DOCTYPE html>

<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi" />
<meta name="format-detection" content="telephone=no" />
<!-- <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script> -->
<!-- <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

</head>
<style>
.spin{display: none;}
</style>
<script type="text/javascript">
    var level = "<%=session.level%>"
    var logPage = 0;
    var pageSize = 10;
    var pageTotal = 0;
    var selectPage = 1;
    var bsCode = "<%=bsCode%>";
    var dcod ="";
    var sdate="";
    var edate="";
    var acno="";
    var rono="";
    var gname="";
    function init(){
        $.loading.start(''); 
        $.ajax({
            url: "/mysql/room",
            data:{
                xml:"sms_log_list",
                bsCode: pad(bsCode, 7),
                sdate:sdate,
                edate:edate,
                page:logPage,
                pageSize:pageSize,
                acno:acno,
                rono:rono,
                gname:gname
            }, success:function(res){
                console.log(res);
                if(res.length > 0){
                    $("#tot_h2").text("총 "+comma(res[0].counts)+"개");
                    pageTotal = res[0].counts;
                    var item ="";
                    
                    for(var i=0; i<res.length; i++){
                        var type = "";
                        var clean = "";

                        if(res[i].SMS_LOG_TYPE == "4"){
                            type = "장문";
                        }else if(res[i].SMS_LOG_TYPE == "1"){
                            type = "단문";
                        }
                        var cont = res[i].SMS_LOG_CONT;
                        cont = cont.substring(0, 30)+"..."; 

                        item += "<tr data-key='"+res[i].SMS_LOG_KEY+"'>"
                            + "<td class='table_list_td text_left'>"
                            + res[i].SMS_LOG_RONO
                            + "</td>"
                            + "<td class='table_list_td text_left'>"
                            + res[i].SMS_LOG_ACNO
                            + "</td>"
                            + "<td class='table_list_td text_left'>"
                            + res[i].SMS_LOG_GNAME
                            + "</td>"
                            + "<td class='table_list_td text_left'>"
                                + res[i].SMS_LOG_TITLE
                            + "</td>"
                            + "<td class='table_list_td text_left'>"
                            + cont
                            + "</td>"
                            + "<td class='table_list_td text_left'>"
                            + type
                            + "</td>"
                            + "<td class='table_list_td text_left'>"
                            + res[i].SMS_LOG_DATE
                            + "</td>"
                            + "</tr>";
                    }
                }else{
                    pageTotal = 0;
                    selectPage = 1;
                    logPage = 0;
                    $("#tot_h2").text("총 "+comma("0")+"개");
                }
                paging(pageTotal, pageSize, selectPage);
                $("#log_table tbody").empty();
                $("#log_table tbody").append(item);
                $.loading.end(); 
            }
        })
    }
    $(window).ready(function() {
        init();
        var myCal = bulmaCalendar.attach('.date_default_inp', {
            isRange: true,
            type: 'date',
            showFooter: false,
            dateFormat: 'yyyy-MM-dd'
        });
        $(".search_icon").on("click", function(){
            if($("input[name='dateSelect']").val() != ""){
                var dateInput = $("input[name='dateSelect']").val();
                dateInput = dateInput.split(" ~ ");
                sdate = dateInput[0];
                edate = dateInput[1];
            }else{
                sdate = "";
            }
            if($("#search_rono").val() != ""){
                rono = $("#search_rono").val();
            }else{
                rono = "";
            }
            if($("#search_acno").val() != ""){
                acno = $("#search_acno").val();
            }else{
                acno = "";
            }
            if($("#search_gname").val() != ""){
                gname = $("#search_gname").val();
            }else{
                gname = "";
            }
            init();
        });
        $(document).on("click", "#foot_page a", function(){
            var page = $(this).attr("data-page");
            var currentpage = page - 1;
            currentpage = currentpage == 0 ? currentpage : currentpage*pageSize;
            selectPage = page;
            logPage = currentpage;

            init();
        });
    });
</script>
<body>
    <div class="right_contbox">
        <div class="main_cont_tbox dis_flex_row dis_flex_center dis_flex_end margin_bottom_20">
            <h2 class="main_cont_tit">문자 내역</h2>
            <div class="main_cont_btn_grp">
                <div calss="main_cont_width main_cont_width01">
                    <button class="icon_btn excel"></button>
                </div>
            </div>
        </div>
        <div class="wcont_box wcont_box_style01">
            <div class="data_search_box dis_flex_row margin_bottom_16">
                <div class="data_search_box dis_flex_row margin_bottom_16">
                    <!-- <div class="data_search_grp">
                        <label class="setup_title">타입</label>
                        <div class="inp_moving_widthbox inp_moving_widthbox02">
                            <div class="inp_moving_width inp_moving_width01">
                                <div class="data_search_inpbox">
                                    <select id="rtype_select" class="sel_style">
                                        <option value="" selected>전체</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <div class="data_search_grp">
                        <label class="setup_title">날짜</label>
                        <div class="inp_moving_widthbox inp_moving_widthbox01 dis_flex_row dis_flex_center">
                            <div class="inp_moving_width inp_moving_width01">
                                <div class="data_search_inpbox">
                                    <input style="min-width: 220px;" name="dateSelect" class="inp_style date_default_inp date date_inp" type="text" placeholder="날짜를 선택해주세요.">
                                </div>
                            </div>
                            <div class="inp_moving_width inp_moving_width01">
                                <div class="data_search_inpbox">
                                    <input id="search_rono" placeholder="객실번호를 입력해 주세요." class="inp_style search search_inp" type="text">
                                </div>
                            </div>
                            <div class="inp_moving_width inp_moving_width01">
                                <div class="data_search_inpbox">
                                    <input id="search_acno" placeholder="예약번호를 입력해 주세요." class="inp_style search search_inp" type="text">
                                </div>
                            </div>
                            <div class="inp_moving_width inp_moving_width01">
                                <div class="data_search_inpbox">
                                    <input id="search_gname" placeholder="성명을 입력해 주세요." class="inp_style search search_inp" type="text">
                                </div>
                            </div>
                            <div style="width:60px;" class="inp_moving_width inp_moving_width02">
                                <button class="default_btn search_icon">검색</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="total_numbox">
                <h2 id="tot_h2"class="total_num_tit">총 0개</h2>
            </div>
            <div class="table_over_stylebox">
                <div class="table_contbox table_header">
                    <table class="table_list">
                        <colgroup>
                            <col width="80px">
                            <col width="150px">
                            <col width="100px">
                            <col width="150px">
                            <col width="350px">
                            <col width="80px">
                            <col width="150px">
                        </colgroup>
                        <thead>
                            <tr>
                                <th class="table_list_th text_left">객실</th>
                                <th class="table_list_th text_left">예약번호</th>
                                <th class="table_list_th text_left">성명</th>
                                <th class="table_list_th text_left">제목</th>
                                <th class="table_list_th text_left">내용</th>
                                <th class="table_list_th text_left">구분</th>
                                <th class="table_list_th text_left">요청 날짜</th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <div class="table_contbox table_body">
                    <table id="log_table" class="table_list hover_table">
                        <colgroup>
                            <col width="80px">
                            <col width="150px">
                            <col width="100px">
                            <col width="150px">
                            <col width="350px">
                            <col width="80px">
                            <col width="150px">
                        </colgroup>
                        <tbody>
                            <tr>
                                <td class="table_list_td text_left">로비</td>
                                <td class="table_list_td text_left">BLE</td>
                                <td class="table_list_td text_left">BOARD 제어</td>
                                <td class="table_list_td text_left">BOARD ON/OFF</td>
                                <td class="table_list_td text_left">
                                    <p class="table_list_td_ok">정상</p>
                                </td>
                                <td class="table_list_td text_left">2022-08-08 AM 10:05:53</td>
                                <td class="table_list_td text_left">00:00:01</td>
                            </tr>
                            <tr>
                                <td class="table_list_td text_left">로비</td>
                                <td class="table_list_td text_left">BLE</td>
                                <td class="table_list_td text_left">BOARD 제어</td>
                                <td class="table_list_td text_left">BOARD ON/OFF</td>
                                <td class="table_list_td text_left">
                                    <p class="table_list_td_no">지연</p>
                                </td>
                                <td class="table_list_td text_left">2022-08-08 AM 10:05:53</td>
                                <td class="table_list_td text_left">00:00:01</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="pagebtn_grp_box">
                <div  id="foot_page" class="pagebtn_grp dis_flex_center dis_flex_row">
                    <a class="pagebtn prev"></a>
                    <a class="pagebtn num active">1</a>
                    <a class="pagebtn num">2</a>
                    <a class="pagebtn num">3</a>
                    <a class="pagebtn num">4</a>
                    <a class="pagebtn num">5</a>
                    <a class="pagebtn next"></a>
                </div>
            </div>
        </div>
    </div>
    <div id="" class="popup_wrap" style="display:flex;">
        <div class="popup_contbox">
            <div class="popup_header_grp">
                <div class="popup_header dis_flex_row dis_flex_center dis_flex_end">
                    <div class="dis_flex_row dis_flex_center">
                        <div class="dis_flex_row dis_flex_center">
                            <h2 id="" class="popup_title popup_title01">상세 내용</h2>
                            
                        </div>
                    </div>
                    <div class="dis_flex_row dis_flex_center">
                        <a id="pop_close_btn" class="popup_close"></a>
                    </div>
                </div>
                
            </div>
            <div class="popup_body">
                <div class="pop_table_contbox">
                    <div class="pop_cont_inp_grp pop_cont_inp_grp_width pop_cont_inp_grp01 dis_flex_row dis_flex_center margin_bottom_16">
                        <div class="pop_cont_inp_box pop_cont_inp_box01">
                            <label class="setup_title">객실</label>
                            <input id="" value="538" class="inp_style" type="text" disabled>
                        </div>
                        <div class="pop_cont_inp_box pop_cont_inp_box02">
                            <label class="setup_title">예약번호</label>
                            <input id="" value="202200000077" class="inp_style" type="text" disabled>
                        </div>
                    </div>
                    <div class="pop_cont_inp_grp pop_cont_inp_grp_width pop_cont_inp_grp02 dis_flex_row dis_flex_center margin_bottom_16">
                        <div class="pop_cont_inp_box pop_cont_inp_box01">
                            <label class="setup_title">성명</label>
                            <input id="" value="오아시스" class="inp_style" type="text" disabled>
                        </div>
                        <div class="pop_cont_inp_box pop_cont_inp_box02">
                            <label class="setup_title">발급 날짜</label>
                            <input id="" value="2022-09-16 PM 16:43" class="inp_style" type="text" disabled>
                        </div>
                    </div>
                    <div class="pop_cont_inp_grp pop_cont_inp_grp03">
                        <div class="pop_cont_inp_box pop_cont_inp_box01 margin_bottom_16">
                            <label class="setup_title">제목</label>
                            <textarea class="textarea_style" disabled></textarea>
                        </div>
                        <div class="pop_cont_inp_box pop_cont_inp_box02">
                            <label class="setup_title">내용</label>
                            <textarea class="textarea_style max_height_180" disabled></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup_footer">
                <div class="popup_btn_grp dis_flex_row dis_flex_center dis_flex_right">
                    <div class="popup_btn_width popup_btn_width02">
                        <button id="pop_confirm_btn" class="popup_btn popup_btn02 popup_btn_save default_btn_gray">확인</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>